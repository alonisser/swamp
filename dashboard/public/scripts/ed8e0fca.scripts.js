"use strict";var app=angular.module("swamp",["ngCookies","ngResource","ngSanitize","ui.router","ui.bootstrap","Scope.safeApply","Scope.onReady","swamp.config","swamp.filters","swamp.controllers","swamp.directives","swamp.services"]);angular.module("swamp.config",[]),angular.module("swamp.filters",[]),angular.module("swamp.controllers",[]),angular.module("swamp.directives",[]),angular.module("swamp.services",[]),app.run(["$rootScope",function(a){a.__len__=function(a){return a=a||{},Object.keys(a).length}}]),app.run(["authApiService","userService","$state","$rootScope","EVENTS",function(a,b,c,d,e){function f(){c.go("login")}function g(a,d){return"login"==d.name&&b.isLoggedIn()?c.transitionTo("dashboard"):"dashboard"!=d.name||b.isLoggedIn()?void 0:c.transitionTo("login")}function h(){}function i(){}function j(){}a.isLoggedIn()["catch"](f),d.$on(e.STATE_CHANGE_START,g),d.$on(e.STATE_CHANGE_ERROR,h),d.$on(e.STATE_CHANGE_SUCCESS,i),d.$on(e.VIEW_CONTENT_LOADED,j)}]),angular.module("swamp.config").constant("env",{name:"production",serviceUptimeTickInterval:1e4,swampReloadSeconds:6,apiBasePath:"/"}),app.config(["env","$httpProvider",function(a){"production"==a.name&&(a.socketConnectionString=socketConnectionString,a.apiBasePath="/")}]),app.config(["$locationProvider","$urlRouterProvider",function(a,b){a.html5Mode(!1),b.otherwise("/login/")}]),angular.module("swamp.config").constant("SOCKET_EVENTS",{CONNECT:"connect",DISCONNECT:"disconnect",MESSAGE:"message",SWAMP_INITIAL:"swamp.initialData",SWAMP_OUT:"swamp.out",SWAMP_ERROR:"swamp.error",SWAMP_RESTART_ALL:"swamp.restartAllRunning",SWAMP_STOP_ALL:"swamp.stopAllRunning",SWAMP_START_ALL:"swamp.startAll",SERVICE_START:"service.start",SERVICE_STOP:"service.stop",SERVICE_RESTART:"service.restart",SERVICE_PENDING:"service.pending",SERVICE_STARTING:"service.starting",SERVICE_ERROR:"service.error",SERVICE_OUT:"service.out",SERVICE_MONITOR:"service.monitor",MODIFY_SERVICE_ENVIRONMENTS:"service.modifyEnvironments",EXECUTE_COMMAND:"service.executeCommand",COMMAND_STARTED:"command.started",COMMAND_OUT:"command.out",COMMAND_DISPOSED:"command.disposed",TERMINATE_COMMAND:"command.terminate",RUN_PRESET:"preset.run",CREATE_PRESET:"preset.create",DELETE_PRESET:"preset.delete",PRESET_CREATED:"preset.created",PRESET_DELETED:"preset.deleted",SERVICE_LOG_OUT_SUBSCRIBE:"service.log.out.subscribe",SERVICE_LOG_OUT_UNSUBSCRIBE:"service.log.out.unsubscribe",SERVICE_LOG_ERROR_SUBSCRIBE:"service.log.error.subscribe",SERVICE_LOG_ERROR_UNSUBSCRIBE:"service.log.error.unsubscribe"}).constant("EVENTS",{SWAMP_SERVICES_RECEIVED:"event::swamp.services.received",SWAMP_DISCONNECTED:"event::swamp.disconnected",SWAMP_OUT:"event::swamp.out",SWAMP_ERROR:"event::swamp.error",SWAMP_DATA_RECEIVED:"event::swamp.data.received",SERVICE_MONITOR_UPDATE:"event::service.monitor.update",SERVICE_START:"event::service.start",SERVICE_STOP:"event::service.stop",SERVICE_RESTART:"event::service.restart",SERVICE_PENDING:"event::service.pending",SERVICE_STARTING:"event::service.starting",SERVICE_OUT:"event::service.out",SERVICE_ERROR:"event::service.error",MODIFY_SERVICE_ENVIRONMENTS:"event::service.modify.environments",COMMAND_STARTED:"event::command.started",COMMAND_OUT:"event::command.out",COMMAND_DISPOSED:"event::command.disposed",PRESET_CREATED:"event::preset.created",PRESET_DELETED:"event::preset.deleted",SWAMP_MANAGER_INITIALIZED:"event::swamp.manager.initialized",SWAMP_SERVICES_MANAGER_INITIALIZED:"event::swamp.services.manager.initialized",OPEN_FOOTER_PANEL:"event::open.footer.panel",FOOTER_PANEL_STATE_CHANGE:"event::footer.panel.state.change",SERVICES_FILTER_CHANGE:"event::services.filter.change",TAIL_LOGS_STATE_CHANGE:"event::tail.logs.state.change",CLEAR_ALL_LOGS:"event::clear.all.logs",VERTICAL_SCROLL_INTO_VIEW:"event::vertical.scroll.into.view",VERTICAL_SCROLL_RECALCULATE_DIMENSIONS:"event::vertical.scroll.recalculate.dimensions",DISPOSE_CONTEXT_MENUS:"event::dispose.context.menus",STATE_CHANGE_START:"$stateChangeStart",STATE_CHANGE_ERROR:"$stateChangeError",STATE_CHANGE_SUCCESS:"$stateChangeSuccess",VIEW_CONTENT_LOADED:"$viewContentLoaded"}).constant("SERVICE_STATE",{NONE:"service.state.none",STOP:"service.state.stop",RUN:"service.state.run",RESTART:"service.state.restart",PENDING:"service.state.pending",STARTING:"service.state.starting"}).constant("CLIENT_REQUEST",{REQUEST_START_SERVICE:"request.start.service",REQUEST_STOP_SERVICE:"request.stop.service",REQUEST_RESTART_SERVICE:"request.restart.service",REQUEST_COMMAND_EXECUTION:"request.command.execution",REQUEST_COMMAND_TERMINATION:"request.command.termination"}).constant("AGGREGATED_LIST_TYPE",{LIFO:1,FIFO:2}).constant("MODAL_TYPE",{SERVICE_ENVIRONMENTS_EDITOR:"modal::service.environments.editor",LOGS_SELECTOR:"modal::logs.selector",PROMPT:"modal::prompt",EXECUTE_COMMAND_PROMPT:"modal::execute.command.prompt",COMMAND_EXECUTION:"modal::command.execution",RUN_PRESET:"modal::run.preset",CREATE_PRESET:"modal::create.preset"}).constant("LOG_TYPE",{OUT:"log.out",ERROR:"log.error"}).constant("SETTING",{VIEW_TYPE:"setting_view_type",SPEECH_ENABLED:"setting_speech_enabled"}).constant("VIEW_TYPE",{LIST:"list",GRID:"grid"}).constant("SPEAKABLE_TEXT",{ALL_SERVICES_STARTED:{text:"all swamp services has started",enqueue:!0},SERVICE_HIGH_CPU_USAGE:{text:"{0} processor usage has reached {1}%!",enqueue:!1}}),angular.module("swamp.config").constant("MODAL_CONFIG",{"modal::service.environments.editor":{templateUrl:"components/modals/environments_editor/environmentsEditor.html",controller:"environmentsEditorController",windowClass:"modal-size_60"},"modal::logs.selector":{templateUrl:"components/modals/logs_selector/logsSelector.html",controller:"logsSelectorController",windowClass:"modal-size_50"},"modal::prompt":{templateUrl:"components/modals/prompt/prompt.html",controller:"promptController",windowClass:"modal-size_30"},"modal::execute.command.prompt":{templateUrl:"components/modals/execute_command_prompt/executeCommandPrompt.html",controller:"executeCommandPromptController",windowClass:"modal-size_50"},"modal::command.execution":{templateUrl:"components/modals/command_execution/commandExecution.html",controller:"commandExecutionController",windowClass:"modal-size_80 max-height"},"modal::run.preset":{templateUrl:"components/modals/run_preset/runPreset.html",controller:"runPresetController",windowClass:"modal-size_40"},"modal::create.preset":{templateUrl:"components/modals/create_preset/createPreset.html",controller:"createPresetController",windowClass:"modal-size_40"}}),app.config(["$tooltipProvider",function(a){a.setTriggers({mouseover:"mouseout"})}]);var ansiparse=function(a){var b,c=null,d=null,e="",f=[],g=[],h={};b=function(){var a,b;e.length?e=e.substr(0,e.length-1):g.length&&(a=g.length-1,b=g[a].text,1===b.length?g.pop():g[a].text=b.substr(0,b.length-1))};for(var i=0;i<a.length;i++)null==c?null==d?""==a[i]?c=a[i]:"\b"==a[i]?b():e+=a[i]:";"==a[i]?(f.push(d),d=""):"m"==a[i]?(f.push(d),d=null,e="",f.forEach(function(a){ansiparse.foregroundColors[a]?h.foreground=ansiparse.foregroundColors[a]:ansiparse.backgroundColors[a]?h.background=ansiparse.backgroundColors[a]:39==a?delete h.foreground:49==a?delete h.background:ansiparse.styles[a]?h[ansiparse.styles[a]]=!0:22==a?h.bold=!1:23==a?h.italic=!1:24==a&&(h.underline=!1)}),f=[]):d+=a[i]:""==c&&"["==a[i]?(e&&(h.text=e,g.push(h),h={},e=""),c=null,d=""):(e+=c+a[i],c=null);return e&&(h.text=e+(c?c:""),g.push(h)),g};ansiparse.foregroundColors={30:"black",31:"red",32:"green",33:"yellow",34:"blue",35:"magenta",36:"cyan",37:"white",90:"grey"},ansiparse.backgroundColors={40:"black",41:"red",42:"green",43:"yellow",44:"blue",45:"magenta",46:"cyan",47:"white"},ansiparse.styles={1:"bold",3:"italic",4:"underline"},String.prototype.format=function(){var a=arguments;return this.replace(/{(\d+)}/g,function(b,c){return"undefined"!=typeof a[c]?a[c]:b})},_.mixin({deepFind:function(a,b,c){var d,e,f,g=0;for(d=b&&b.split("."),e=d&&d.length;e>g&&a;){if(f=d[g],g++,g>=e&&null!=c)return void(a[f]=c);a=a[f]}return e>g&&(a=null),a}}),_.mixin({pushAll:function(a,b){a.push.apply(a,b)}}),_.mixin({emptyArray:function(a){a.length=0}}),_.mixin({nextPrevPageParser:function(a){var b={},c=a._resultmeta||a;return c.next&&(b.next=_.parseInt(/\w*page=(\d+)/i.exec(c.next)[1])),c.previous&&(b.prev=_.parseInt(/\w*page=(\d+)/i.exec(c.previous)[1])),b}}),_.mixin({cloneArray:function(a){return a.slice(0)}}),_.mixin({throttleStore:function(a,b,c){var d=[],e=_.throttle(function(){a(_.cloneArray(d)),_.emptyArray(d)},b,c);return function(a){_.pushAll(d,a),e()}}}),_.mixin({arrayRemoveItem:function(a,b){var c=a.indexOf(b);-1!=c&&a.splice(c,1)}}),_.mixin({getUrls:function(a){for(var b,c,d=/((ftp|https?):\/\/|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s.;,(){}<>]/,e=[];c=a.match(d);)b=c[0],e.push(b),a=a.replace(b,"");return e}}),_.mixin({guid:function(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).substr(-4)}}),_.mixin({bytesToSize:function(a){var b=1e3,c=["Bytes","KB","MB","GB","TB"];if(0===a)return"0 Bytes";var d=parseInt(Math.floor(Math.log(a)/Math.log(b)),10);return(a/Math.pow(b,d)).toPrecision(3)+" "+c[d]}}),_.mixin({toArray:function(a){var b=[],a=a||{};return _.forEach(a,function(a){b.push(a)}),b}}),_.mixin({ansi:function(a){return ansiparse(a)}}),angular.module("swamp.filters").filter("trim",[function(){return function(a,b){return b=b||220,null!==a&&void 0!==a?a.length>=b?[a.substring(0,b),"..."].join(""):a:void 0}}]),angular.module("swamp.services").factory("swampServicesFactory",["$rootScope","env","SERVICE_STATE","CLIENT_REQUEST","aggregatedDataFactory","AGGREGATED_LIST_TYPE","LOG_TYPE","serializeService","EVENTS","swampManager","modalService","MODAL_TYPE","speechService","SPEAKABLE_TEXT",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(a){this.id=a.id,this.name=a.name,this.description=a.description,this.path=a.path,this.script=a.script,this.isRunning=a.isRunning,this.runningEnvironment=a.runningEnvironment,this.selectedEnvironment=a.runningEnvironment,this.pid=a.pid,this.startIndex=a.options.startIndex,this.options=a.options,this.environments=a.environments,this.monitorCpu=a.monitor.cpu,this.monitorMemory=a.monitor.memory,this.monitor=a.monitor,this.phase=a.phase,this.state=this._translateState(),this.threshold=a.threshold,this.viewOptions=a.viewOptions,this.startTime=a.startTime,this.uptime=null,this._uptimeInterval=null,this._resetTrendsTimeout=null,this._createMonitorDataContainers(),this._createLogDataContainers(this.options.maxLogsToSave),this.isRunning&&this._startUptimeMessageSync(),q.call(this,a.logs)}function p(a){return new o(a)}function q(a){var b,c=this;a.err&&_.forEach(a.err,function(a){b=h.serializeLogData(g.ERROR,a),c.errorLogData.add(b)}),a.out&&_.forEach(a.out,function(a){b=h.serializeLogData(g.OUT,a),c.outLogData.add(b)})}var r=90;return o.prototype={setEnvironments:function(b){this.environments=b,a.$safeApply()},updateMonitorData:function(b){!this.monitor.cpu&&isNaN(this.monitor.cpu)||!b.cpu||(b.cpu>this.monitor.cpu?(this.monitor.cpuTrend=1,b.cpu>r&&m.speak(n.SERVICE_HIGH_CPU_USAGE.text.format(this.name,b.cpu.toFixed(0)),n.SERVICE_HIGH_CPU_USAGE.enqueue)):b.cpu<this.monitor.cpu&&(this.monitor.cpuTrend=-1)),!this.monitor.memory&&isNaN(this.monitor.memory)||!b.memory||(b.memory>this.monitor.memory?this.monitor.memoryTrend=1:b.memory<this.monitor.memory&&(this.monitor.memoryTrend=-1)),_.extend(this.monitor,b),isNaN(this.monitor.cpu)||this.cpuData.add(this.monitor.cpu),isNaN(this.monitor.memory)||this.memoryData.add(this.monitor.memory),a.$safeApply(),this._resetTrendsTimeout=setTimeout(function(){this.monitor.cpuTrend=0,this.monitor.memoryTrend=0}.bind(this),1e3)},stop:function(){a.$broadcast(d.REQUEST_STOP_SERVICE,this)},start:function(b){b=b||this.selectedEnvironment,a.$broadcast(d.REQUEST_START_SERVICE,this,b)},restart:function(b){b=b||this.selectedEnvironment,a.$broadcast(d.REQUEST_RESTART_SERVICE,this,b)},executeCommand:function(b){a.$broadcast(d.REQUEST_COMMAND_EXECUTION,this,b)},forceStop:function(){this._stopUptimeMessageSync(),this.pid=null,this.isRunning=!1,this.startTime=null,this.cpuData.clear(),this.memoryData.clear(),this.monitor.cpu=!1,this.monitor.memory=!1,this.state=c.STOP,a.$safeApply()},forceStart:function(b){this._startUptimeMessageSync(),this._merge(b),this.state=c.RUN,this.selectedEnvironment=this.runningEnvironment,a.$safeApply()},forceRestart:function(){this.state=c.RESTART,a.$safeApply()},forcePending:function(){this.state=c.PENDING,a.$safeApply()},forceStarting:function(){this.state=c.STARTING,a.$safeApply()},log:function(a,b){var c=h.serializeLogData(a,b);switch(a){case g.OUT:this.outLogData.add(c);break;case g.ERROR:this.errorLogData.add(c)}},clearErrorLogs:function(){this.errorLogData.clear()},clearOutLogs:function(){this.outLogData.clear()},clearLogs:function(){this.clearErrorLogs(),this.clearOutLogs()},openIOStreamer:function(a){window.open("/io/"+this.id+"/"+a+"/")},dispose:function(){this.forceStop()},_merge:function(a){_.assign(this,a)},_createMonitorDataContainers:function(){this.cpuData=e.create(f.FIFO,20),this.memoryData=e.create(f.FIFO,20)},_createLogDataContainers:function(a){this.outLogData=e.create(f.FIFO,a),this.errorLogData=e.create(f.FIFO,a)},_translateState:function(){return"STARTED"==this.phase?c.RUN:"NONE"==this.phase?c.NONE:"STARTING"==this.phase?c.STARTING:"STOPPING"==this.phase?c.PENDING:"STOPPED"==this.phase?c.STOP:"PENDING"==this.phase?c.PENDING:void 0},_startUptimeMessageSync:function(){this._stopUptimeMessageSync(),this.uptime=moment(this.startTime).fromNow(),a.$safeApply(),this._uptimeInterval=setTimeout(function(){this._startUptimeMessageSync()}.bind(this),b.serviceUptimeTickInterval)},_stopUptimeMessageSync:function(){clearTimeout(this._uptimeInterval),this._uptimeInterval=null,this.uptime=null},getContextMenu:function(){var b=j.getCommands(),d=[{title:"Out log",command:function(){a.$broadcast(i.OPEN_FOOTER_PANEL,this.outLogData.id)}.bind(this)},{title:"Error log",command:function(){a.$broadcast(i.OPEN_FOOTER_PANEL,this.errorLogData.id)}.bind(this)},{title:"Restart",disabled:this.state!=c.RUN,command:function(){this.restart()}.bind(this)},{title:"Start",disabled:this.state!=c.STOP,command:function(){this.start()}.bind(this)},{title:"Stop",disabled:this.state!=c.RUN,command:function(){this.stop()}.bind(this)},{title:"Force Stop",command:function(){this.stop()}.bind(this)},{title:"Process I/O",command:[{title:"STDOUT",command:function(){this.openIOStreamer("out")}.bind(this)},{title:"STDERR",command:function(){this.openIOStreamer("error")}.bind(this)}]}];if(b.length>0){var e=[];b.length&&_.forEach(b,function(a){e.push({title:a.name,command:function(a){if("remote"==j.getInfo().mode){var b=k.open(l.EXECUTE_COMMAND_PROMPT,{service:this,command:a});b.result.then(function(){this.executeCommand(a.id)}.bind(this))}else this.executeCommand(a.id)}.bind(this,a)})}.bind(this)),d.push({title:"Commands",disabled:0==b.length,command:e})}return d}},{create:p}}]),angular.module("swamp.services").factory("aggregatedDataFactory",["AGGREGATED_LIST_TYPE","$rootScope",function(a,b){function c(b,c){this.id=_.guid(),this.type=b||a.FIFO,this.maxItems=c||0,this._freezed=!1,this._queuedData=[],this._data=[]}function d(a,b){return new c(a,b)}return c.prototype={add:function(a){if(this._freezed)this._queuedData.push(a);else{if(this._data.push(a),this.maxItems>0&&this.count()>this.maxItems)return this._automatedRemove();b.$safeApply()}},remove:function(a){this._data.splice(a,1),b.$safeApply()},get:function(a){return this._data[a]},getAll:function(){return this._data},clear:function(){this._data.length=0,b.$safeApply()},toggleFreeze:function(){this._freezed?this.unfreeze():this.freeze()},freeze:function(){this._freezed||(this._freezed=!0)},unfreeze:function(){this._freezed&&(this._freezed=!1,_.pushAll(this._data,this._queuedData),this._queuedData.length=0)},count:function(){return this._data.length},getLast:function(){return this.get(this.count()-1)},_automatedRemove:function(){switch(this.type){case a.FIFO:this.remove(0);break;case a.LIFO:this.remove(this.count()-1)}}},{create:d}}]),angular.module("swamp.services").factory("modalParamsFactory",["MODAL_CONFIG",function(a){function b(a,b){this.resolve={},this._type=a,this._payload=b,this.initialize()}function c(a,c){return new b(a,c)}var d={templateUrl:"",controller:""};return b.prototype={initialize:function(){var b=this,c=a[this._type]||d;_.forEach(c,function(a,b){this[b]=a}.bind(this)),this.resolve.$payload=[function(){return b._payload}]}},{create:c}}]),angular.module("swamp.services").service("serializeService",[function(){this.serializeSwampService=function(a){return{id:a.id,name:a.name,description:a.description,path:a.path,script:a.script,isRunning:a.isRunning,runningEnvironment:a.runningEnvironment,pid:a.pid,startTime:a.startTime,options:a.options,phase:a.phase,environments:a.environments,monitorCpu:a.monitor.cpu,monitorMemory:a.monitor.memory,logs:a.logs,threshold:a.threshold,viewOptions:{toggle:!1,envMenuOpen:!1},monitor:{cpu:!1,memory:!1}}},this.serializeMonitorData=function(a){var b={cpu:!1,memory:!1};return isNaN(a.monitor.cpu)||(b.cpu=a.monitor.cpu),isNaN(a.monitor.memory)||(b.memory=a.monitor.memory),b},this.serializeServiceStart=function(a){return{isRunning:a.isRunning,runningEnvironment:a.runningEnvironment,pid:a.pid,startTime:a.startTime}},this.serializeServiceStop=function(a){return{pid:a.pid,startTime:a.startTime}},this.serializeLogData=function(a,b){return{type:a,text:b.text,time:moment(b.time)}},this.serializeServiceEnvironments=function(a){return a.environments},this.serializeExecutionCommand=function(a){var b={exeId:a.exeId,commandId:a.commandId,serviceName:a.serviceName,command:a.command};return b.command.timestamp=(new Date).valueOf(),b},this.serializeCommandOut=function(a){return{exeId:a.exeId,commandId:a.commandId,serviceName:a.serviceName,log:a.log}},this.serializeCommandDisposed=function(a){return{exeId:a.exeId,commandId:a.commandId,serviceName:a.serviceName,success:a.success}},this.serializePreset=function(a){return{id:a.id,name:a.name,services:a.services,inStorage:a.inStorage}}}]),angular.module("swamp.services").service("socketService",["SOCKET_EVENTS","EVENTS","swampServicesManager","serializeService","env","$rootScope","tokenService","speechService",function(a,b,c,d,e,f,g,h){this._socket=null,this.setup=function(){var a=g.getAccessToken();this._socket=io.connect(e.socketConnectionString,{reconnect:!1,query:"x-access-token="+a}),this._bindSocketEvents()},this._bindSocketEvents=function(){this._socket.on(a.CONNECT,this._onSocketConnect.bind(this)),this._socket.on(a.DISCONNECT,this._onSocketDisconnect.bind(this)),this._socket.on(a.MESSAGE,this._onSocketMessage.bind(this))},this._emit=function(a,b){b=b||{},a=a.name||a,this._socket.emit(a,b)},this._onSocketConnect=function(){},this._onSocketDisconnect=function(){f.$broadcast(b.SWAMP_DISCONNECTED)},this._onSocketMessage=function(c){if(c&&c.event)switch(c.event){case a.SWAMP_INITIAL:var e=[];_.forEach(c.data.services||[],function(a){e.push(d.serializeSwampService(a))}),f.$broadcast(b.SWAMP_DATA_RECEIVED,c.data.swamp,c.data.commands,c.data.presets),f.$broadcast(b.SWAMP_SERVICES_RECEIVED,e);break;case a.SWAMP_OUT:var g=c.data.log;f.$broadcast(b.SWAMP_OUT,g),h.speakIfSpeakable(g.text);break;case a.SWAMP_ERROR:var g=c.data.log;f.$broadcast(b.SWAMP_ERROR,g);break;case a.SERVICE_MONITOR:var e=d.serializeMonitorData(c.data),i=c.data.name;f.$broadcast(b.SERVICE_MONITOR_UPDATE,i,e);break;case a.SERVICE_START:var e=d.serializeServiceStart(c.data),i=c.data.name;f.$broadcast(b.SERVICE_START,i,e);break;case a.SERVICE_STOP:var e=d.serializeServiceStop(c.data),i=c.data.name;f.$broadcast(b.SERVICE_STOP,i,e);break;case a.SERVICE_RESTART:var i=c.data.name;f.$broadcast(b.SERVICE_RESTART,i);break;case a.SERVICE_PENDING:var i=c.data.name;f.$broadcast(b.SERVICE_PENDING,i);break;case a.SERVICE_STARTING:var i=c.data.name;f.$broadcast(b.SERVICE_STARTING,i);break;case a.SERVICE_OUT:var i=c.data.name,g=c.data.log;f.$broadcast(b.SERVICE_OUT,i,g);break;case a.SERVICE_ERROR:var i=c.data.name,g=c.data.log;f.$broadcast(b.SERVICE_ERROR,i,g);break;case a.MODIFY_SERVICE_ENVIRONMENTS:var e=d.serializeServiceEnvironments(c.data),i=c.data.name;f.$broadcast(b.MODIFY_SERVICE_ENVIRONMENTS,i,e);break;case a.COMMAND_STARTED:var e=d.serializeExecutionCommand(c.data);f.$broadcast(b.COMMAND_STARTED,e);break;case a.COMMAND_OUT:var e=d.serializeCommandOut(c.data);f.$broadcast(b.COMMAND_OUT,e);break;case a.COMMAND_DISPOSED:var e=d.serializeCommandDisposed(c.data);f.$broadcast(b.COMMAND_DISPOSED,e);break;case a.PRESET_CREATED:var e=d.serializePreset(c.data);f.$broadcast(b.PRESET_CREATED,e);break;case a.PRESET_DELETED:var j=c.data;f.$broadcast(b.PRESET_DELETED,j)}},f.$on(a.SERVICE_START,this._emit.bind(this)),f.$on(a.SERVICE_STOP,this._emit.bind(this)),f.$on(a.SERVICE_RESTART,this._emit.bind(this)),f.$on(a.SWAMP_STOP_ALL,this._emit.bind(this)),f.$on(a.SWAMP_RESTART_ALL,this._emit.bind(this)),f.$on(a.SWAMP_START_ALL,this._emit.bind(this)),f.$on(a.MODIFY_SERVICE_ENVIRONMENTS,this._emit.bind(this)),f.$on(a.EXECUTE_COMMAND,this._emit.bind(this)),f.$on(a.TERMINATE_COMMAND,this._emit.bind(this)),f.$on(a.RUN_PRESET,this._emit.bind(this)),f.$on(a.CREATE_PRESET,this._emit.bind(this)),f.$on(a.DELETE_PRESET,this._emit.bind(this)),f.$on(a.SERVICE_LOG_OUT_SUBSCRIBE,this._emit.bind(this)),f.$on(a.SERVICE_LOG_OUT_UNSUBSCRIBE,this._emit.bind(this)),f.$on(a.SERVICE_LOG_ERROR_SUBSCRIBE,this._emit.bind(this)),f.$on(a.SERVICE_LOG_ERROR_UNSUBSCRIBE,this._emit.bind(this))}]),angular.module("swamp.services").service("swampManager",["$rootScope","EVENTS","LOG_TYPE","serializeService","aggregatedDataFactory","AGGREGATED_LIST_TYPE","SOCKET_EVENTS","CLIENT_REQUEST",function(a,b,c,d,e,f,g,h){function i(a,b){this.log(c.OUT,b)}function j(a,b){this.log(c.ERROR,b)}function k(a){var b=this;a&&(_.forEach(a.out||[],function(a){b.log(c.OUT,a)}),_.forEach(a.err||[],function(a){b.log(c.ERROR,a)}))}function l(a){a&&_.extend(this._info,a)}function m(a){a&&a.definitions&&(this._commands=a.definitions),a&&a.executions&&_.pushAll(this._commandsExecution,a.executions)}function n(a){a&&_.pushAll(this._presets,a)}function o(c,d,e,f){k.call(this,d.logs),l.call(this,d.info),m.call(this,e),n.call(this,f),a.$broadcast(b.SWAMP_MANAGER_INITIALIZED)}function p(a){return _.where(this._commandsExecution,function(b){return b.id==a})[0]}function q(a,b){var c=p.call(this,b.exeId);c||this._commandsExecution.push(b.command)}function r(a,b){var c=p.call(this,b.exeId);c&&c.log.push(b.log)}function s(a,b){var c=p.call(this,b.exeId);c&&(c.disposed=!0,c.success=b.success)}function t(b,c){a.$broadcast(g.TERMINATE_COMMAND,{id:c})}function u(a,b){this._presets.push(b)}function v(a,b){_.remove(this._presets,function(a){return a.id==b})}this.outLogData=null,this.errorLogData=null,this._info={totalmem:0,mode:"*"},this._commands=[],this._commandsExecution=[],this._presets=[],this.getInfo=function(){return this._info},this.getCommands=function(){return this._commands},this.getCommandsExecution=function(){return this._commandsExecution},this.getPresets=function(){return this._presets},this.runPreset=function(b){a.$broadcast(g.RUN_PRESET,{id:b.id})},this.createPreset=function(b){a.$broadcast(g.CREATE_PRESET,{preset:b})},this.deletePreset=function(b){a.$broadcast(g.DELETE_PRESET,{presetId:b})},this.log=function(a,b){var e=d.serializeLogData(a,b);switch(a){case c.OUT:this.outLogData.add(e);break;case c.ERROR:this.errorLogData.add(e)}},this._createLogDataContainers=function(){this.outLogData=e.create(f.FIFO),this.errorLogData=e.create(f.FIFO)},this.initialize=function(){this._createLogDataContainers()},a.$on(b.SWAMP_OUT,i.bind(this)),a.$on(b.SWAMP_ERROR,j.bind(this)),a.$on(b.SWAMP_DATA_RECEIVED,o.bind(this)),a.$on(b.COMMAND_STARTED,q.bind(this)),a.$on(b.COMMAND_OUT,r.bind(this)),a.$on(b.COMMAND_DISPOSED,s.bind(this)),a.$on(b.PRESET_CREATED,u.bind(this)),a.$on(b.PRESET_DELETED,v.bind(this)),a.$on(h.REQUEST_COMMAND_TERMINATION,t)}]),angular.module("swamp.services").service("swampServicesManager",["swampServicesFactory","$rootScope","EVENTS","CLIENT_REQUEST","SOCKET_EVENTS","LOG_TYPE","SERVICE_STATE",function(a,b,c,d,e,f,g){function h(){_.forEach(this._services,function(a){a.dispose(),this.removeById(a.id)}.bind(this))}function i(a,d){_.forEach(d,function(a){this.addServiceByRaw(a)}.bind(this)),b.$broadcast(c.SWAMP_SERVICES_MANAGER_INITIALIZED)}function j(a,b,c){var d=this.getByName(b);d&&d.updateMonitorData(c)}function k(a,b,c){var d=this.getByName(b);d&&d.forceStart(c)}function l(a,b,c){var d=this.getByName(b);d&&d.forceStop(c)}function m(a,b){var c=this.getByName(b);c&&c.forceRestart()}function n(a,b){var c=this.getByName(b);c&&c.forcePending()}function o(a,b){var c=this.getByName(b);c&&c.forceStarting()}function p(a,b,c){var d=this.getByName(b);d&&d.log(f.OUT,c)}function q(a,b,c){var d=this.getByName(b);d&&d.log(f.ERROR,c)}function r(a,b,c){var d=this.getByName(b);d&&d.setEnvironments(c)}function s(a,c,d){var f={name:c.name,environment:d};b.$broadcast(e.SERVICE_START,f)}function t(a,c){var d={name:c.name};b.$broadcast(e.SERVICE_STOP,d)}function u(a,c,d){var f={name:c.name,environment:d};b.$broadcast(e.SERVICE_RESTART,f)}function v(a,c,d){var f={name:c.name,commandId:d};b.$broadcast(e.EXECUTE_COMMAND,f)}function w(){h.call(this)}this._services={},this.addService=function(a){this._services[a.id]=a},this.addServiceByRaw=function(c){this.addService(a.create(c)),b.$safeApply()},this.count=function(){return this._services?Object.keys(this._services).length:0},this.countRunning=function(){return this._services?_.where(this._services,{state:g.RUN}).length:0},this.countStopped=function(){return this._services?_.where(this._services,{state:g.STOP}).length:0},this.countRestarting=function(){return this._services?_.where(this._services,{state:g.RESTART}).length:0},this.countPending=function(){return this._services?_.where(this._services,{state:g.PENDING}).length:0},this.countStarting=function(){return this._services?_.where(this._services,{state:g.STARTING}).length:0},this.getAll=function(){return this._services},this.getByName=function(a){return _.first(_.where(this._services,{name:a}))},this.getById=function(a){return this._services[a]||null},this.removeById=function(a){delete this._services[a],b.$safeApply()},this.stopAllRunningServices=function(){b.$broadcast(e.SWAMP_STOP_ALL)},this.restartAllRunningServices=function(){b.$broadcast(e.SWAMP_RESTART_ALL)},this.startAllServices=function(){b.$broadcast(e.SWAMP_START_ALL)},this.modifyServiceEnvironments=function(a,c,d){var f=this.getByName(a);if(f){var g={name:f.name,environments:c,restart:d};b.$broadcast(e.MODIFY_SERVICE_ENVIRONMENTS,g)}},this.subscribeServiceOutLog=function(a){b.$broadcast(e.SERVICE_LOG_OUT_SUBSCRIBE,{serviceId:a})},this.unsubscribeServiceOutLog=function(a){b.$broadcast(e.SERVICE_LOG_OUT_UNSUBSCRIBE,{serviceId:a})},this.subscribeServiceErrorLog=function(a){b.$broadcast(e.SERVICE_LOG_ERROR_SUBSCRIBE,{serviceId:a})},this.unsubscribeServiceErrorLog=function(a){b.$broadcast(e.SERVICE_LOG_ERROR_UNSUBSCRIBE,{serviceId:a})},b.$on(c.SWAMP_SERVICES_RECEIVED,i.bind(this)),b.$on(c.SWAMP_DISCONNECTED,w.bind(this)),b.$on(c.SERVICE_MONITOR_UPDATE,j.bind(this)),b.$on(c.SERVICE_START,k.bind(this)),b.$on(c.SERVICE_STOP,l.bind(this)),b.$on(c.SERVICE_RESTART,m.bind(this)),b.$on(c.SERVICE_PENDING,n.bind(this)),b.$on(c.SERVICE_STARTING,o.bind(this)),b.$on(c.SERVICE_OUT,p.bind(this)),b.$on(c.SERVICE_ERROR,q.bind(this)),b.$on(c.MODIFY_SERVICE_ENVIRONMENTS,r.bind(this)),b.$on(d.REQUEST_START_SERVICE,s.bind(this)),b.$on(d.REQUEST_STOP_SERVICE,t.bind(this)),b.$on(d.REQUEST_RESTART_SERVICE,u.bind(this)),b.$on(d.REQUEST_COMMAND_EXECUTION,v.bind(this))}]),angular.module("swamp.services").service("modalService",["$modal","MODAL_TYPE","modalParamsFactory",function(a,b,c){var d=null;this.open=function(b,e){this.close();var f=c.create(b,e);return d=a.open(f)},this.dismiss=function(a){d&&d.dismiss&&(d.dismiss(a),d=null)},this.close=function(a){if(d&&d.close)try{d.close(a)}catch(b){}finally{d=null}}}]),angular.module("swamp.services").service("authApiService",["$http","env","userService","$state","swampManager","socketService","tokenService",function(a,b,c,d,e,f,g){function h(){g.resetToken(),location.reload()}function i(){c.setLoggedIn(!0),d.go("dashboard"),e.initialize(),f.setup()}function j(a){g.setAccessToken(a.data.accessToken)}this.isLoggedIn=function(){return a.get(b.apiBasePath+"api/auth/login/",{headers:{"x-access-token":g.getAccessToken()}}).then(i.bind(this))},this.login=function(c,d){return a.post(b.apiBasePath+"api/auth/login/",{username:c,password:d}).then(j).then(i.bind(this))},this.logout=function(){return a.post(b.apiBasePath+"api/auth/logout/",{},{headers:{"x-access-token":g.getAccessToken()}})["finally"](h)}}]),angular.module("swamp.services").service("userService",[function(){this._isLoggedIn=!1,this.isLoggedIn=function(){return this._isLoggedIn},this.setLoggedIn=function(a){this._isLoggedIn=a}}]),angular.module("swamp.services").service("tokenService",["$cookieStore",function(a){var b="";this.setAccessToken=function(c){b=c,a.put("_at",c)},this.getAccessToken=function(){return b||a.get("_at")},this.resetToken=function(){b="",a.remove("_at")}}]),angular.module("swamp.services").service("settingsService",["$cookieStore",function(a){this.get=function(b){return a.get(b)},this.set=function(b,c){a.put(b,c)}}]),angular.module("swamp.services").service("speechService",["settingsService","SETTING","SPEAKABLE_TEXT",function(a,b,c){function d(){this._queue.length>0&&this.speak(this._queue.shift(),!1)}var e=!!window.speechSynthesis&&!!window.SpeechSynthesisUtterance,f="en-US";this._queue=[],this.speak=function(c,g){if(e&&a.get(b.SPEECH_ENABLED)){if(window.speechSynthesis.speaking)return void(g&&this._queue.push(c));var h=new SpeechSynthesisUtterance(c);h.lang=f,h.onend=d.bind(this),window.speechSynthesis.speak(h)}},this.speakIfSpeakable=function(a){_.forEach(c,function(b){return b.text==a?this.speak(a,b.enqueue):void 0}.bind(this))},this.stop=function(){e&&window.speechSynthesis.cancel&&window.speechSynthesis.cancel()}}]),angular.module("swamp.services").provider("fullScreenMessage",function(){var a=null,b={};return b._defaultOptions={},b.$get=["$compile","$http","$q","$templateCache","$injector","$rootScope","$controller",function(c,d,e,f,g,h,i){function j(a){return a.template?e.when(a.template):d.get(a.templateUrl,{cache:f}).then(function(a){return a.data})}function k(a){var b=[];return angular.forEach(a,function(a){(angular.isFunction(a)||angular.isArray(a))&&b.push(e.when(g.invoke(a)))}),b}function l(a){return a=angular.extend({},b._defaultOptions,a),a.resolve=a.resolve||{},a}function m(a){var a=l(a);if(!a.template&&!a.templateUrl)throw new Error("One of template or templateUrl options is required.");var b=e.all([j(a)].concat(k(a.resolve)));b.then(function(b){var d=(a.scope||h).$new(),e={};if(a.controller){var f=1;e.$scope=d,angular.forEach(a.resolve,function(a,c){e[c]=b[f++]}),i(a.controller,e)}var g=$("<sw-full-screen-message></sw-full-screen-message>");g.html(b[0]),g=c(g)(e.$scope),$(document.body).append(g)})}return{close:function(){$(".sw-full-screen-message").remove()},open:function(b){a&&this.close(),m(b)}}}],b}),angular.module("swamp.directives").directive("swPerfectScrollbar",["$parse",function(a){return{restrict:"A",priority:100,link:function(b,c,d){function e(){g=setTimeout(function(){c.is(":visible")&&(h=!0,c.find(".ps-scrollbar-x-rail, .ps-scrollbar-y-rail").css({display:"block",opacity:"0.9"}),c.perfectScrollbar("update")),!h&&e()},f)}var f=500,g=null,h=!1;if(c.perfectScrollbar({wheelSpeed:a(d.wheelSpeed)()||50,wheelPropagation:a(d.wheelPropagation)()||!1,minScrollbarLength:a(d.minScrollbarLength)()||!1,suppressScrollX:a(d.suppressScrollX)()||!1,suppressScrollY:a(d.suppressScrollY)()||!1}),d.scrollPositionOutside){var i=parseInt(c.css("padding-right")),j=parseInt(c.css("margin-right"));c.css("padding-right",i+15+"px"),c.css("margin-right",j-15+"px")
}d.scrollDisplayed&&e(),c.find(d.refreshOnChange).resize(function(){c.scrollTop(0).perfectScrollbar("update")}),b.updateScroll=function(){c.scrollTop(0).perfectScrollbar("update")},b.$on("$destroy",function(){c.perfectScrollbar("destroy"),c.remove(),c=null})}}}]),angular.module("swamp.directives").directive("swScroll",[function(){return{restrict:"A",scope:{swScroll:"&",autoScrollBottom:"="},link:function(a,b){function c(){i&&clearTimeout(i),i=setTimeout(function(){g!=b.scrollTop()&&a.swScroll&&a.swScroll(),g=b.scrollTop()},500)}function d(){j=setTimeout(function(){b.scrollTop(b[0].scrollHeight),d()},h)}function e(){clearTimeout(j),j=null}function f(a){a?(b.scrollTop(b[0].scrollHeight),d()):e()}var g=b.scrollTop(),h=100,i=(b.height(),null),j=null;a.$watch(function(){return a.autoScrollBottom},function(a){f(a)}),b.on("scroll",c),a.$on("$destroy",function(){b.off("scroll",c),clearTimeout(i),clearTimeout(j),b.remove(),b=null})}}}]),angular.module("swamp.directives").directive("swCheckbox",[function(){return{restrict:"E",scope:{checked:"=ngModel",label:"=checkboxLabel",onCheckStateChange:"&"},templateUrl:"directives/checkbox/checkbox.html",link:function(a){a.onCheckStateChange&&a.$watch(function(){return a.checked},function(b){a.onCheckStateChange({state:b})})}}}]),angular.module("swamp.directives").directive("swScrollState",["EVENTS","$rootScope",function(a,b){return{restrict:"A",scope:{onScroll:"&onPageScroll"},link:function(a,c,d){function e(){var c=window.scrollY>f;c!=g&&(a.onScroll&&a.onScroll({state:c}),g=c,b.$safeApply())}var f=d.scrollOffset?parseInt(d.scrollOffset):100,g=!1;$(window).on("scroll",e),a.$on("$destroy",function(){$(window).off("scroll",e),c.remove(),c=null})}}}]),angular.module("swamp.directives").directive("swAggregatedDataChart",["$compile",function(a){return{restrict:"E",scope:{model:"=ngModel",minValue:"=",maxValue:"=",maxItems:"=",lineColor:"@",formatValue:"&",hideData:"=showNaMessage"},replace:!0,templateUrl:"directives/aggregated_data_chart/aggregatedDataChart.html",link:function(b,c,d){function e(c){var d=b.$new(!0),e=b.formatValue&&b.formatValue({value:c})||"";d.label=e,d.itemCssClass=k;var g=a(f)(d),m=g.find(".chart-bar"),n=c/h*100;m.css("border-color",j),m.css("height",n+"%"),m.css("background-color",j),l.append(g),i>-1&&l.find("li").length>i&&l.find("li").first().remove(),l.css("width",20*l.find("li").length)}var f='<li tooltip="{{label}}" tooltip-append-to-body="true" class="flex flex-align-end"><div class="chart-bar {{itemCssClass}}"></div></li>',g='<div class="no-data-container flex flex-align-center flex-pack-center text-30">N/A</div>',h=(b.minValue?parseInt(b.minValue):0,b.maxValue?parseInt(b.maxValue):100),i=b.maxItems?parseInt(b.maxItems):-1,j=b.lineColor?"#"+b.lineColor:"#ffffff",k=d.itemCssClass||"",l=c.find("ul");b.dataItems=b.model.getAll(),b.$watchCollection("dataItems",function(){var a=b.model.getLast();0!=a&&void 0!==a&&e(a)}),b.$watch(function(){return b.hideData},function(a){a?c.append(g):c.find(".no-data-container").remove()}),b.$on("$destroy",function(){c.empty(),c.remove(),c=null}),function(){_.forEach(b.dataItems,function(a){0!=a&&void 0!==a&&e(a)})}()}}}]),angular.module("swamp.directives").directive("swVerticalScroller",["$timeout","$rootScope","EVENTS",function(a,b,c){return{restrict:"A",link:function(d,e,f){function g(){var a=0;return w.children(u).each(function(){a+=$(this).outerWidth(!0)}),a+1}function h(){a(function(){var a=g(),b=w.find(u).outerHeight();w.css({width:a+"px",height:b+"px"}),w.css(v,0);var c=parseInt(e.css("padding-top"))+parseInt(e.css("padding-bottom"));e.css("height",b+c+"px")})}function i(){p.appendTo(e),q.appendTo(e)}function j(){if(!(w.outerWidth()<e.outerWidth())){var a=parseInt(w.css("left")),b=a+t;b>0&&(b=0),w.css("left",b)}}function k(){if(!(w.outerWidth()<e.outerWidth())){var a=parseInt(w.css("left")),b=a-t;w.outerWidth()-Math.abs(b)<e.outerWidth()&&(b=-1*(w.outerWidth()-e.outerWidth())),w.css("left",b)}}function l(){p.on("mousedown",j),q.on("mousedown",k)}function m(){p.off("mousedown",j),q.off("mousedown",k),r&&r(),s&&s()}function n(a,b){var c=w.find(b);if(c.length){var d=c.offset();if(d.left<0){var f=parseInt(w.css("left")),g=f+Math.abs(d.left);w.css("left",g)}else if(d.left+c.outerWidth()>e.outerWidth()){var f=parseInt(w.css("left")),g=f-Math.abs(d.left);g-w.outerWidth()<e.outerWidth()&&(g=-1*(w.outerWidth()-e.outerWidth())),w.css("left",g)}}}var o='<div class="sw-scroller-arrow flex flex-align-center"></div>',p=$(o).addClass("sw-left-arrow"),q=$(o).addClass("sw-right-arrow"),r=null,s=null,t=100,u=f.itemSelector,v=f.wrapperPosition||"top",w=e.find(".sw-vertical-scroller-wrapper");h(),i(),l(),d.$on("$destroy",function(){m(),e.remove()}),r=b.$on(c.VERTICAL_SCROLL_INTO_VIEW,n),s=b.$on(c.VERTICAL_SCROLL_RECALCULATE_DIMENSIONS,h)}}}]),angular.module("swamp.directives").directive("swFullScreenMessage",["$rootScope","EVENTS",function(){return{restrict:"E",replace:!0,templateUrl:"directives/full_screen_message/fullScreenMessage.html",transclude:!0,link:function(){}}}]),angular.module("swamp.directives").directive("swFooterLogUnit",["$sce",function(a){return{restrict:"E",scope:{tab:"=ngModel",height:"=unitHeight"},templateUrl:"directives/footer_log_unit/footerLogUnit.html",link:function(b,c){b.pauseTabLog=function(){b.tab.paused=!b.tab.paused,b.tab.paused?b.tab.content.freeze():b.tab.content.unfreeze()},b.parseTapLogAsHtml=function(){b.tab.parseAsHtml=!b.tab.parseAsHtml},b.parseAnsi=function(b){var c=_.ansi(b);b="";for(var d=0,e=c.length;e>d;d++)b+=c[d].foreground?'<span style="color:'+c[d].foreground+'">'+c[d].text+"</span>":c[d].text;return a.trustAsHtml(b)},b.$on("$destroy",function(){c.empty(),c.remove(),c=null})}}}]),angular.module("swamp.directives").directive("swModalContent",["modalService",function(a){return{restrict:"E",transclude:!0,replace:!0,templateUrl:"directives/modal_content/modalContent.html",scope:{title:"=modalTitle"},link:function(b){function c(){}b.dismiss=function(){a.dismiss()},b.confirm=function(){a.close()},b.$on("$destroy",c)}}}]),angular.module("swamp.directives").directive("swFocusBool",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){b.$watch(d.swFocusBool,function(b){b&&a(function(){c.focus()})})}}}]),angular.module("swamp.directives").directive("swContextMenu",["$rootScope","EVENTS",function(a,b){return{restrict:"A",scope:{$payload:"=swContextMenu"},compile:function(){var c='<div class="sw-context-menu"><ul></ul></div>',d='<div class="sw-sub-context-menu"><ul></ul></div>',e="<li></li>";return function(f,g){function h(){var a=f.$payload.getContextMenu();n=$(c),_.forEach(a,function(a){var b=$(e);if(b.text(a.title),a.command instanceof Array){b.addClass("sub-menu-container");var c=$(d);_.forEach(a.command,function(a){var b=$(e);b.text(a.title),b.on("click",i.bind(f.$payload,a)),a.disabled&&b.addClass("disabled"),c.find("ul").append(b)}),b.append(c)}else"function"==typeof a.command&&(b.on("click",i.bind(f.$payload,a)),a.disabled&&b.addClass("disabled"));n.find(">ul").append(b)})}function i(b,c){c.stopPropagation(),b.disabled||(b.command&&b.command(),k(),a.$safeApply())}function j(a,b){n&&(n.css({top:a,left:b}),n.appendTo(document.body))}function k(){n&&(n.find("ul li").each(function(){$(this).off()}),n.remove(),n=null),$(document).off("click",m)}function l(c){a.$broadcast(b.DISPOSE_CONTEXT_MENUS),c.preventDefault(),c.stopPropagation();var d=c.pageX,e=c.pageY;h(),j(e,d),$(document).on("click",m)}function m(){n&&k()}var n=null;g.on("contextmenu",l),f.$on("$destroy",function(){g.off("contextmenu",l),$(document).off("click",m),k()}),a.$on(b.DISPOSE_CONTEXT_MENUS,k)}}}}]),angular.module("swamp.controllers").controller("headerController",["$scope","$rootScope","EVENTS","authApiService","swampManager",function(a,b,c,d,e){a.handler={pageScrolled:!1,serviceQuery:"",info:e.getInfo()},a.onPageScrolled=function(b){a.handler.pageScrolled=b},a.clearFilter=function(){a.handler.serviceQuery=""},a.logout=function(){d.logout()},a.$watch(function(){return a.handler.serviceQuery},function(a){b.$broadcast(c.SERVICES_FILTER_CHANGE,a)})}]),angular.module("swamp.controllers").controller("footerController",["$scope","$rootScope","EVENTS","swampManager","swampServicesManager","$timeout","modalService","MODAL_TYPE",function(a,b,c,d,e,f,g,h){function i(d,e){d&&(_.forEach(a.tabsContent,function(b){d[b.id]?_.find(a.enabledTabsContent,{id:b.id})||(a.enabledTabsContent.push(b),b.onOpen&&b.onOpen(b)):e||(_.remove(a.enabledTabsContent,{id:b.id}),b.onClose&&b.onClose(b))}),a.enabledTabsContent.length>0&&(a.setActive(a.enabledTabsContent[0].id),b.$emit(c.VERTICAL_SCROLL_RECALCULATE_DIMENSIONS)))}function j(){a.handler.panelContentHeight=k()}function k(){return $(window).innerHeight()-64}function l(){var b=_.where(a.enabledTabsContent,{active:!0});a.handler.title=b.length?b[0].name:""}function m(d,e){if(!_.find(a.enabledTabsContent,{id:e})){var g={};g[e]=!0,i(g,!0)}a.setActive(e),a.handler.collapsed=!1,f(function(){b.$broadcast(c.VERTICAL_SCROLL_INTO_VIEW,"#tab_item_"+e)},10),b.$emit(c.VERTICAL_SCROLL_RECALCULATE_DIMENSIONS)}function n(){a.tabsContent.push({id:d.outLogData.id,active:!1,tailed:y,parseAsHtml:!1,paused:!1,query:"",inQueryMode:!1,itemcls:"color-green",name:"Swamp out log",content:d.outLogData}),a.tabsContent.push({id:d.errorLogData.id,active:!1,tailed:y,parseAsHtml:!1,paused:!1,query:"",inQueryMode:!1,itemcls:"color-red",name:"Swamp error log",content:d.errorLogData}),a.handler.initializing=!1}function o(){_.forEach(e.getAll(),function(b){a.tabsContent.push({id:b.outLogData.id,serviceId:b.id,service:b,active:!1,tailed:y,parseAsHtml:!1,paused:!1,query:"",inQueryMode:!1,itemcls:"color-warm-grey",name:b.name+" out log",content:b.outLogData,onOpen:s,onClose:t,onStart:p,onStop:q,onRestart:r}),a.tabsContent.push({id:b.errorLogData.id,serviceId:b.id,service:b,active:!1,tailed:y,parseAsHtml:!1,paused:!1,query:"",inQueryMode:!1,itemcls:"color-red",name:b.name+" error log",content:b.errorLogData,onOpen:u,onClose:v,onStart:p,onStop:q,onRestart:r})}),a.handler.initializing=!1}function p(b){a.serviceActions.start(b)}function q(b){a.serviceActions.stop(b)}function r(b){a.serviceActions.restart(b)}function s(a){a.serviceId&&e.subscribeServiceOutLog(a.serviceId)}function t(a){a.serviceId&&e.unsubscribeServiceOutLog(a.serviceId)}function u(a){a.serviceId&&e.subscribeServiceErrorLog(a.serviceId)}function v(a){a.serviceId&&e.unsubscribeServiceErrorLog(a.serviceId)}function w(b,c){y=c,_.forEach(a.tabsContent,function(a){a.tailed=c})}function x(){_.forEach(a.tabsContent,function(a){a.content.clear()})}a.handler={collapsed:!0,initializing:!0,title:"",maximized:!1,panelContentHeight:300,swampVersion:window.swampVersion},a.tabsContent=[],a.enabledTabsContent=[];var y=!1;a.setActive=function(b){_.forEach(a.tabsContent,function(c){c.active=b==c.id,c.active&&(a.handler.title=c.name)})},a.toggleView=function(){a.handler.maximized?($(window).off("resize",j),a.handler.panelContentHeight=300):(j(),$(window).on("resize",j)),a.handler.maximized=!a.handler.maximized},a.openLogsWindow=function(){var b={tabsContent:a.tabsContent,enabledTabsContent:a.enabledTabsContent};g.open(h.LOGS_SELECTOR,b).result.then(i)},a.closeTabPanel=function(d,e){d.stopPropagation(),d.preventDefault();var g=_.remove(a.enabledTabsContent,{id:e});if(g[0].onClose&&g[0].onClose(g[0]),0==a.enabledTabsContent.length)a.handler.panelContentHeight=300,a.handler.maximized=!1,a.handler.title="";else if(g[0].active){var h=a.enabledTabsContent[0].id;a.setActive(h),f(function(){b.$broadcast(c.VERTICAL_SCROLL_INTO_VIEW,"#tab_item_"+h)},10)}b.$emit(c.VERTICAL_SCROLL_RECALCULATE_DIMENSIONS)},a.$watch(function(){return a.handler.collapsed},function(d){d?a.handler.title="":l(),b.$broadcast(c.FOOTER_PANEL_STATE_CHANGE,d)}),b.$on(c.OPEN_FOOTER_PANEL,m),b.$on(c.SWAMP_MANAGER_INITIALIZED,n),b.$on(c.SWAMP_SERVICES_MANAGER_INITIALIZED,o),b.$on(c.TAIL_LOGS_STATE_CHANGE,w),b.$on(c.CLEAR_ALL_LOGS,x)}]),angular.module("swamp.controllers").controller("asideController",["$scope","$rootScope","EVENTS","swampManager","swampServicesManager","modalService","MODAL_TYPE","SETTING","settingsService","speechService",function(a,b,c,d,e,f,g,h,i,j){function k(){a.handler.servicesCount=e.count()}a.handler={tailCheckState:!1,servicesCount:0,executionCommands:d.getCommandsExecution(),presets:d.getPresets(),speechEnabled:!!i.get(h.SPEECH_ENABLED)},a.toggleSpeech=function(){a.handler.speechEnabled?(j.stop(),i.set(h.SPEECH_ENABLED,null),a.handler.speechEnabled=!1):(i.set(h.SPEECH_ENABLED,1),a.handler.speechEnabled=!0)},a.restartAll=function(){if("remote"==d.getInfo().mode){var a=f.open(g.PROMPT,{name:"running services",action:"restart all"});a.result.then(function(){e.restartAllRunningServices()})}else e.restartAllRunningServices()},a.stopAll=function(){if("remote"==d.getInfo().mode){var a=f.open(g.PROMPT,{name:"running services",action:"stop all"});a.result.then(function(){e.stopAllRunningServices()})}else e.stopAllRunningServices()},a.startAll=function(){if("remote"==d.getInfo().mode){var a=f.open(g.PROMPT,{name:"services",action:"start all"});a.result.then(function(){e.startAllServices()})}else e.startAllServices()},a.showLog=function(a){var e;e="out"==a?d.outLogData.id:d.errorLogData.id,b.$broadcast(c.OPEN_FOOTER_PANEL,e)},a.onCheckStateChange=function(a){b.$broadcast(c.TAIL_LOGS_STATE_CHANGE,a)},a.clearAllLogs=function(){b.$broadcast(c.CLEAR_ALL_LOGS)},a.openCommandExecutionWindow=function(a){f.open(g.COMMAND_EXECUTION,a)},a.startPreset=function(a){var b=f.open(g.RUN_PRESET,a);b.result.then(function(a){d.runPreset(a)})},a.createPreset=function(){var a=f.open(g.CREATE_PRESET);a.result.then(function(a){d.createPreset(a)})},b.$on(c.SWAMP_SERVICES_MANAGER_INITIALIZED,k)}]),angular.module("swamp.controllers").controller("disconnectMessageController",["$scope","env","$timeout","speechService",function(a,b,c,d){function e(){a.handler.reconnectTimeout--,0==a.handler.reconnectTimeout?f():c(e,1e3)}function f(){window.location.reload()}a.handler={reconnectTimeout:b.swampReloadSeconds},a.reconnect=function(){d.stop(),f()},d.speak("Houston, we have a problem"),e()}]),angular.module("swamp.controllers").controller("environmentsEditorController",["$scope","$payload","swampServicesManager","modalService",function(a,b,c,d){function e(){a.handler.showAddVariable=!a.handler.showAddVariable}function f(){a.handler.addedVariable={key:"",value:""}}a.handler={isEnvMenuOpen:!1,selectedEnvironment:{},addedVariable:{key:"",value:""},showAddVariable:!1},a.service=b,a.serviceEnvironments=_.cloneDeep(b.environments),a.editedEnvironment="",a.editedVariable="",a.loadEnvironment=function(b){a.editedVariable="",a.editedEnvironment=b},a.editEnvironmentVariable=function(b){a.editedVariable=b},a.addVariable=function(){f(),e()},a.saveVariable=function(b){b.stopPropagation();var c=a.handler.addedVariable.key,d=a.handler.addedVariable.value;a.handler.selectedEnvironment[c]=d,e(),f()},a.removeVariable=function(b,c){b.stopPropagation(),delete a.handler.selectedEnvironment[c]},a.undoVariableEdit=function(b,c){b.stopPropagation(),a.handler.selectedEnvironment[c]=a.service.environments[a.editedEnvironment][c],a.editedVariable=""},a.service.selectedEnvironment&&a.loadEnvironment(a.service.selectedEnvironment),a.close=function(){d.close()},a.save=function(b){c.modifyServiceEnvironments(a.service.name,a.serviceEnvironments,b),a.close()}}]),angular.module("swamp.controllers").controller("logsSelectorController",["$scope","$payload","modalService",function(a,b,c){a.handler={filterQuery:"",filteredTabsContent:[]},a.selectedTabs={},a.tabsContent=b.tabsContent,a.enabledTabsContent=b.enabledTabsContent,a.applyChanges=function(){c.close(a.selectedTabs)},a.cancel=function(){c.dismiss()},_.forEach(a.enabledTabsContent,function(b){a.selectedTabs[b.id]=!0})}]),angular.module("swamp.controllers").controller("promptController",["$scope","$payload","modalService",function(a,b,c){a.name=b.name,a.action=b.action,a.dismiss=function(){c.dismiss()},a.confirm=function(){c.close()}}]),angular.module("swamp.controllers").controller("executeCommandPromptController",["$scope","$payload","modalService",function(a,b,c){a.service=b.service,a.command=b.command,a.dismiss=function(){c.dismiss()},a.confirm=function(){c.close()}}]),angular.module("swamp.controllers").controller("commandExecutionController",["$scope","$rootScope","$payload","modalService","CLIENT_REQUEST","$sce",function(a,b,c,d,e,f){a.execution=c,a.terminating=!1,a.dismiss=function(){d.dismiss()},a.confirm=function(){d.close()},a.parseAnsi=function(a){var b=_.ansi(a);a="";for(var c=0,d=b.length;d>c;c++)a+=b[c].foreground?'<span style="color:'+b[c].foreground+'">'+b[c].text+"</span>":b[c].text;return f.trustAsHtml(a)},a.terminate=function(){a.terminating=!0,b.$broadcast(e.REQUEST_COMMAND_TERMINATION,a.execution.id)}}]),angular.module("swamp.controllers").controller("runPresetController",["$scope","$payload","modalService","swampManager",function(a,b,c,d){a.preset=b,a.applyChanges=function(){c.close(a.preset)},a.cancel=function(){c.dismiss()},a.deletePreset=function(){d.deletePreset(a.preset.id),c.dismiss()}}]),angular.module("swamp.controllers").controller("createPresetController",["$scope","swampServicesManager","SERVICE_STATE","modalService",function(a,b,c,d){a.presetParams={name:"",services:_.pluck(_.where(b.getAll(),{state:c.RUN}),"name")},a.create=function(){d.close(a.presetParams)},a.cancel=function(){d.dismiss()}}]),angular.module("swamp.controllers").controller("mainController",["$scope","$rootScope","EVENTS","fullScreenMessage",function(a,b,c,d){function e(b,c){a.footerOpen=!c}function f(){d.open({templateUrl:"components/disconnect_message/disconnectMessage.html",controller:"disconnectMessageController"})}a.footerOpen=!1,b.$on(c.FOOTER_PANEL_STATE_CHANGE,e),b.$on(c.SWAMP_DISCONNECTED,f)}]),app.config(["$stateProvider",function(a){a.state("dashboard",{url:"/dashboard/",templateUrl:"pages/dashboard/dashboardView.html",controller:"dashboardController"})}]),angular.module("swamp.controllers").controller("dashboardController",["$scope","$rootScope","swampServicesManager","swampManager","SERVICE_STATE","EVENTS","modalService","settingsService","MODAL_TYPE","VIEW_TYPE","SETTING",function(a,b,c,d,e,f,g,h,i,j,k){function l(b,c){a.handler.servicesFilter=c}function m(){a.totalSwampMemory=d.getInfo().totalmem,a.services=_.toArray(c.getAll()),a.handler.isLoading=!1,n()}function n(){a.totalRunning=c.countRunning(),a.totalStopped=c.countStopped(),a.totalRestarting=c.countRestarting(),a.totalPending=c.countPending(),a.totalStarting=c.countStarting(),b.$safeApply()}a.handler={servicesFilter:"",orderBy:"startIndex",orderByDir:"",filteredServices:[],isLoading:!0,pageScrolled:!1,viewType:h.get(k.VIEW_TYPE)||j.LIST},a.SERVICE_STATE=e,a.VIEW_TYPE=j,a.totalSwampMemory=0,a.services=[],a.totalRunning=0,a.totalStopped=0,a.totalRestarting=0,a.totalPending=0,a.totalStarting=0,a.serviceActions={start:function(a,b){if("remote"==d.getInfo().mode){var c=g.open(i.PROMPT,{name:a.name,action:"start"});c.result.then(function(){a.start(b)})}else a.start(b)},stop:function(a){if("remote"==d.getInfo().mode){var b=g.open(i.PROMPT,{name:a.name,action:"stop"});b.result.then(function(){a.stop()})}else a.stop()},restart:function(a,b){if("remote"==d.getInfo().mode){var c=g.open(i.PROMPT,{name:a.name,action:"restart"});c.result.then(function(){a.restart(b)})}else a.restart(b)},showServiceOutLog:function(a){b.$broadcast(f.OPEN_FOOTER_PANEL,a.outLogData.id)},showServiceErrorLog:function(a){b.$broadcast(f.OPEN_FOOTER_PANEL,a.errorLogData.id)},openEnvironmentsEditor:function(a){g.open(i.SERVICE_ENVIRONMENTS_EDITOR,a)}},a.onPageScrolled=function(b){a.handler.pageScrolled=b},a.changeViewType=function(b){a.handler.viewType=b,h.set(k.VIEW_TYPE,b)},a.bytesToSize=_.bytesToSize,a.orderBy=function(b){a.handler.orderByDir=a.handler.orderBy==b?"-"==a.handler.orderByDir?"":"-":"",a.handler.orderBy=b},a.formatMemoryValue=function(a){return a?_.bytesToSize(a):""},a.formatCpuValue=function(a){return isNaN(a)?"":a+"%"},_.toArray(c.getAll()).length&&m(),b.$on(f.SERVICES_FILTER_CHANGE,l),b.$on(f.SWAMP_SERVICES_MANAGER_INITIALIZED,m),b.$on(f.SERVICE_START,n),b.$on(f.SERVICE_STOP,n),b.$on(f.SERVICE_RESTART,n),b.$on(f.SERVICE_PENDING,n),b.$on(f.SERVICE_STARTING,n)}]),app.config(["$stateProvider",function(a){a.state("404",{url:"/404/",templateUrl:"pages/404/404.html",controller:"404Controller"})}]),angular.module("swamp.controllers").controller("404Controller",["$scope",function(a){a.reload=function(){location.href=location.origin}}]),app.config(["$stateProvider",function(a){a.state("login",{url:"/login/",templateUrl:"pages/login/login.html",controller:"loginController"})}]),angular.module("swamp.controllers").controller("loginController",["$scope","authApiService",function(a,b){function c(b){a.err=b.statusText}a.credentials={username:"",password:""},a.err=null,a.login=function(){a.err=null,b.login(a.credentials.username,a.credentials.password)["catch"](c)}}]);